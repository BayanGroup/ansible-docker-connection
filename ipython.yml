#!/usr/bin/env ansible-playbook
---
- name: create an ipython container
  hosts: ipython
  connection: docker
  vars:
    base_image: ubuntu
    pre_image: lorin/ipython-base
    final_image: lorin/ipython

  pre_tasks:
    - name: start up a docker container by running bash
      local_action: docker image={{ base_image }} name={{ inventory_hostname }} detach=yes tty=yes command=bash

    - name: update apt repo (raw)
      raw: apt-get update

    - name: install python 2.7 (raw)
      raw: apt-get install -y python2.7

  roles:
    - ipython

  post_tasks:
    - name: capture the container to a base image
      local_action: command docker commit {{ inventory_hostname }} {{ pre_image }}
    - name: stop the current running container
      local_action: command docker kill {{ inventory_hostname }}
    - name: create the final image
      local_action: docker_image path=./files name={{ final_image }} state=build
